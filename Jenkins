pipeline {
    agent any
    stages {
        stage('build') {
            steps {
                script{
                    sh '''
                    touch .env
                    echo "TOKEN_GIT=\"$TOKEN_GIT\"" >> .env
                    bash docker_build.bash "$TOKEN_DOCKER"
                    '''
                }
            }
        }
    }
    post {
        always {
            deleteDir()
        }
        success {
            script{
                sh '''
                echo "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKekNDQWcrZ0F3SUJBZ0lDQm5Vd0RRWUpLb1pJaHZjTkFRRUxCUUF3TXpFVk1CTUdBMVVFQ2hNTVJHbG4KYVhSaGJFOWpaV0Z1TVJvd0dBWURWUVFERXhGck9ITmhZWE1nUTJ4MWMzUmxjaUJEUVRBZUZ3MHlNakV3TVRReApNalU1TXpSYUZ3MDBNakV3TVRReE1qVTVNelJhTURNeEZUQVRCZ05WQkFvVERFUnBaMmwwWVd4UFkyVmhiakVhCk1CZ0dBMVVFQXhNUmF6aHpZV0Z6SUVOc2RYTjBaWElnUTBFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUIKRHdBd2dnRUtBb0lCQVFDemt2ejhvNUF0cUtyNkZEc0FUVFMrNjdCWXpvdTVERXExOFhuNVc5NTA5NHZEYkZBMApDUXBCNTNaVXpjU2JZaFBvM3ZSSWhqY2RGZjhFbE1uQU5CWW0wbE5aY1BUbW1uY3NoWDJtUDdjaS8yYmN1TlQzCkZQZzdNYnZTWitybVptKytDNTlkb1FpaGVCa0lyaVF4MlAwV0RHeTFyNGJFNnVYK2NpdFduZHhuYVV1U2dFa28KdmFZZXlRelhEc3kwTmY5dVVscVM4ZFJvL3c5RDZmdTcyRElZS2grSXY5R3NuT1pGNkFEWXhzclphWHBrYVZNMwpxUDdFeDZUaFpHay9lendJMnllYkE2akNyZ0JhcDg3NlZYdXJDUjl5bDVIcGtPNEdQOHdGZWdtTTc0ZVpGVWRvClptNFZZTUdzcXlzR1JZUW9WVUFTK0JHU1Jjby9zV2FOQTQwUEFnTUJBQUdqUlRCRE1BNEdBMVVkRHdFQi93UUUKQXdJQmhqQVNCZ05WSFJNQkFmOEVDREFHQVFIL0FnRUFNQjBHQTFVZERnUVdCQlJ1QmNWbmN6MWQwS3ViOFlteAo0dnFnS2NHNm5UQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFjWnJqUi9OdnEraWg3N2xlc29yTjRMdmRwRHh1Cmd3OVVaN2NFNDlaZWNFTEd3UkUwRHlPS21HeStsa0hKMWU0dXVEdjA5aUk0YXFWaFhrby93M05MMDBZRnlldksKNm9mcXdKQ1dIbUIzL1pSbkJsZUZyeWpuOWhvd3ZFbDQyNlk1ZnJLb2p5cFYxcmg0RjQ0Qm1tZUdKcjRmZ2c3NwpaTzJlT1BHU2RaMzB3K3JZQm1nTmMra2UwcnRocm4xcWlueHZmd0xmeTZNbjgrUjIrd3RHZDJGYXUvWXVlaThrCmNKSWttT0RQczZRZVlXdzZLMWFYQjkzbExLOFdObDcrWm1WVU0xenNoMmpSZlNNR1dCVitDNWZGWVcwdGUzVFMKcXJacURqZk5ZalE4a0ZYc2VxZG5WbU5aemZFWkNkcjk0WVNUOXVtSmlpL0NGaXFSL0hkenZMZGNXUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K" >> ca.crt
                curl --cacert ca.crt -X PUT http://localhost:8080/apis/apps/v1/namespaces/operation/deployments/products/scale -H "Content-type: application/json" -d '{"kind":"Scale","apiVersion":"autoscaling/v1","metadata":{"name":"products","namespace":"operation"},"spec":{"replicas":0}}'
                curl --cacert ca.crt -X PUT http://localhost:8080/apis/apps/v1/namespaces/operation/deployments/products/scale -H "Content-type: application/json" -d '{"kind":"Scale","apiVersion":"autoscaling/v1","metadata":{"name":"products","namespace":"operation"},"spec":{"replicas":1}}'
                '''
            }
        }
    }
}