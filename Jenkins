pipeline {
    agent any
    stages {
        stage('build') {
            steps {
                script{
                    sh '''
                    touch .env
                    echo "TOKEN_GIT=\"$TOKEN_GIT\"" >> .env
                    bash docker_build.bash "$TOKEN_DOCKER"
                    '''
                }
            }
        }
    }
    post {
        always {
            deleteDir()
        }
        success {
            script{
                sh '''
                /usr/local/bin/kubectl scale deployment products --replicas=0 --namespace=operation
                /usr/local/bin/kubectl scale deployment products --replicas=1 --namespace=operation
                '''
            }
        }
    }
}